<!doctype html>
<html lang="en">
<head>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script type="text/javascript" src="knockout-latest.js"></script>

</head>
<body>
<div class="container">

<h3>Kalkulačka &ndash; Reference</h3>
	<a href="data.js">data</a>
<br>
<h3>Kalkulačka &ndash; Domácnosti</h3>

<p>Když protopíte: <input type="range" data-bind="value: dum_spotreba, valueUpdate: 'input'" min="1" max="30"> &nbsp; 
<b data-bind="text: dum_spotreba"></b><b> MWh / rok</b>, což je
<b data-bind="text: (dum_spotreba() * 3600 / 1000).toFixed(0)"></b><b> GJ / rok</b> 
<br>
<button data-bind="click: dum_spotreba(DATA.cr_domacnost_topeni_avg)">Jako průměrná česká domácnost</button>.
<br>
Cena elektřiny: <input type="range" data-bind="value: cena_kwh, valueUpdate: 'input'" min="0.5" max="5" step="0.1"> &nbsp; <b data-bind="text: cena_kwh"></b> <b>Kč / kWh</b>.
</p>

<p>Elektrický kotel: <span data-bind="html: format_co2(elektrokotel_co2())"></span>
<br>
Elektřina stojí: <span data-bind="html: format_cena(dum_spotreba() * 1000 * cena_kwh())"></span>
</p>

<p>Tepelné čerpadlo: <span data-bind="html: format_co2(cerpadlo_co2())"></span><br>
Topný faktor COP <input type="range" data-bind="value: cerpadlo_cop, valueUpdate: 'input'" min="1" max="5" step='0.1'> &nbsp; <b data-bind="text: cerpadlo_cop"></b>
<br>
Elektřina stojí: <span data-bind="html: format_cena(dum_spotreba() * 1000 * cena_kwh() / cerpadlo_cop())"></span>
<br>
Jaktože má tepelné čerpadlo větší emise CO<sub>2</sub> než plynový kotel? Je to tím, že elektřina v České republice je dost špinavá &ndash; přes 40% energie se vyrobí v hnědouhelných elektrárnách, viz
<a href="https://cs.wikipedia.org/wiki/Energetika_v_%C4%8Cesku">[wikipedie]</a>.
<!-- TODO solar -->
</p>

<p>Kotel na plyn (účinnost 95%): <span data-bind="html: format_co2(kotel_na_plyn_co2())"></span></p>

<p>Kotel na uhlí (účinnost <span data-bind="text: (100*ucinnost_kotel_uhli()).toFixed(0)"></span>%): <span data-bind="html: format_co2(kotel_na_uhli_co2())"></span>.
<!-- TODO nejen emise CO2 - sira, pevne castice, ... - uhli == shit -->
</p>

<h3>Kalkulačka &ndash; Jídlo</h3>
<p>


Jídelníček:
    <select data-bind="options: typy_jidelnicku,
                       value: selJidelnicek,
                       valueAllowUnset: true"></select>
&ndash;

<b data-bind="text: jidlo_den"></b><b> kg CO<sub>2</sub> / den</b>, což je stejné jako
<span data-bind="html: autem_html(jidlo_den()/ 1000)"></span>. V součtu je to
<span data-bind="html: format_co2(jidlo_den() * 365 / 1000)"></span>
</p>



<!-- 

script	

-->

<script type="text/javascript" src="data.js"></script>

<script type="text/javascript">

var lety = {
	'Praha > Londýn': 1034,
	'Praha > Moskva': 1668,
	'Praha > New York': 6568,
}

var ref_let = 'Praha > New York';


function format_cena(kc) {
	return "<b>" + kc.toFixed(0) + ",- Kč</b>" ;
}


// TODO hezci widgety na letadlo & auto

function letadlem_html(tuny_co2) {
		var let_co2 = lety[ref_let] * DATA.letadlo_co2_km_avg / 1000;
		var ratio = tuny_co2 / let_co2;

		return "<b>" + ratio.toFixed(1) + "</b> letů <b>" + ref_let + "</b>";
}

function autem_html(tuny_co2) {
		var auto_km = 1000 * tuny_co2 / DATA.auto_co2_km_avg;
		return "<b>" + auto_km.toFixed(0) + " km</b> ujetých osobním autem";
}

var typy_jidelnicku = ['vegan', 'vegetarián', 'průměr ČR', 'masožrout'];
var jidelnicek = {
'vegan':DATA.jidlo_vegan_den,
'vegetarián':DATA.jidlo_vegetarian_den,
'průměr ČR':DATA.jidlo_avg_den,
'masožrout':DATA.jidlo_masozrout_den
};


function AppViewModel() {
	this.selJidelnicek = ko.observable(typy_jidelnicku[2]);
	this.jidlo_den = ko.computed(function() {
		return jidelnicek[this.selJidelnicek()];
	}, this);

	this.dum_spotreba = ko.observable(DATA.cr_domacnost_topeni_avg);

	this.cerpadlo_cop = ko.observable(3);
	this.cena_kwh = ko.observable(3); // kc / kwh
	this.ucinnost_kotel_uhli = ko.observable(0.7); 

    this.elektrokotel_co2 = ko.computed(function() {
		return this.dum_spotreba() * DATA.elektrina_cr_mix_emise;
	}, this);

    this.kotel_na_plyn_co2 = ko.computed(function() {
		return this.dum_spotreba() * DATA.plyn_emise / 0.95;
	}, this);

    this.kotel_na_uhli_co2 = ko.computed(function() {
		return this.dum_spotreba() * DATA.hnede_uhli_emise / this.ucinnost_kotel_uhli();
	}, this);

    this.cerpadlo_co2 = ko.computed(function() {
		return this.dum_spotreba() * DATA.elektrina_cr_mix_emise / this.cerpadlo_cop();
	}, this);

	this.format_co2 = function(tuny_co2) {
		var cmp_html = ", stejně jako " + letadlem_html(tuny_co2) + ", nebo " + autem_html(tuny_co2) + ".";
		return "<b>za rok " + tuny_co2.toFixed(2) + " tun CO<sub>2</sub></b>" + cmp_html;
	};

}

// Activates knockout.js
ko.applyBindings(new AppViewModel());  

</script>

</div>
</body>
</html>
